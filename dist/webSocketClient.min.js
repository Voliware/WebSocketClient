if("undefined"==typeof EventSystem)throw new Error("WebSocketClient requires @voliware/eventsystem");class WebSocketClient extends EventSystem{constructor({url:t="ws://localhost",autoReconnect:e=!0,maxReconnectAttempts:s=0,reconnectIntervalTimer:n=1e3,binaryType:c="blob"}){super(),this.url=t,this.websocket=null,this.binaryType=c,this.reconnectInterval=null,this.reconnectAttempts=0,this.reconnectIntervalTimer=n,this.maxReconnectAttempts=s,this.autoReconnect=e,this.wasClosedOnPurpose=!1;let o="https:"===window.location.protocol,i=this.url.split(":");o&&"wss"!==i[0]&&(i[0]="wss",this.url=i.join(":"))}getReadyState(){return this.websocket?this.websocket.readyState:WebSocket.CLOSED}getIsConnected(){return this.getReadyState()===WebSocket.OPEN}connect(){this.close(),this.websocket=new WebSocket(this.url),this.websocket.binaryType=this.binaryType,this.attachWebSocketHandlers()}disconnect(){this.close()}close(){this.websocket&&(this.wasClosedOnPurpose=!0,this.websocket.close()),this.websocket=null}attachWebSocketHandlers(){this.websocket.addEventListener("open",t=>{this.stopAutoReconnect(),this.emit("open",t)}),this.websocket.addEventListener("message",t=>{this.emit("message",t)}),this.websocket.addEventListener("error",t=>{this.emit("error",t),this.autoReconnect&&null===this.reconnectInterval&&this.startAutoReconnect()}),this.websocket.addEventListener("close",t=>{this.emit("close",t),this.wasClosedOnPurpose||t.wasClean||!this.autoReconnect||null!==this.reconnectInterval||this.startAutoReconnect(),this.wasClosedOnPurpose=!1})}send(t){this.websocket.send(t)}sendJson(t){this.send(JSON.stringify(t))}startAutoReconnect(){this.reconnectAttempts=0,this.reconnectInterval=setInterval(this.reconnect.bind(this),this.reconnectIntervalTimer)}stopAutoReconnect(){clearInterval(this.reconnectInterval),this.reconnectInterval=null}reconnect(){!this.maxReconnectAttempts||this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,this.connect()):this.stopAutoReconnect()}}WebSocketClient.status={disconnected:0,connected:1,error:2,connecting:3,string:["Disconnected","Connected","Error","Connecting"],status:[Status.warning,Status.success,Status.error,Status.info]};