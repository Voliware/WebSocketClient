if("undefined"==typeof EventSystem)throw new Error("WebSocketClient requires @voliware/eventsystem");class WebSocketClient extends EventSystem{constructor({url:t="ws://localhost",auto_reconnect:e=!0,max_reconnect_attempts:s=0,reconnect_interval_timer:n=1e3,binary_type:c="blob"}){super(),this.url=t,this.websocket=null,this.binary_type=c,this.reconnect_interval=null,this.reconnect_attempts=0,this.reconnect_interval_timer=n,this.max_reconnect_attempts=s,this.auto_reconnect=e,this.was_closed_on_purpose=!1;let o="https:"===window.location.protocol,i=this.url.split(":");o&&"wss"!==i[0]&&(i[0]="wss",this.url=i.join(":"))}getReadyState(){return this.websocket?this.websocket.readyState:WebSocket.CLOSED}getIsConnected(){return this.getReadyState()===WebSocket.OPEN}connect(){this.close(),this.websocket=new WebSocket(this.url),this.websocket.binary_type=this.binary_type,this.attachWebSocketHandlers()}disconnect(){this.close()}close(){this.websocket&&(this.was_closed_on_purpose=!0,this.websocket.close()),this.websocket=null}attachWebSocketHandlers(){this.websocket.addEventListener("open",t=>{this.stopAutoReconnect(),this.emit("open",t)}),this.websocket.addEventListener("message",t=>{this.emit("message",t)}),this.websocket.addEventListener("error",t=>{this.emit("error",t),this.auto_reconnect&&null===this.reconnect_interval&&this.startAutoReconnect()}),this.websocket.addEventListener("close",t=>{this.emit("close",t),this.was_closed_on_purpose||t.wasClean||!this.auto_reconnect||null!==this.reconnect_interval||this.startAutoReconnect(),this.was_closed_on_purpose=!1})}send(t){this.websocket.send(t)}sendJson(t){this.send(JSON.stringify(t))}startAutoReconnect(){this.reconnect_attempts=0,this.reconnect_interval=setInterval(this.reconnect.bind(this),this.reconnect_interval_timer)}stopAutoReconnect(){clearInterval(this.reconnect_interval),this.reconnect_interval=null}reconnect(){!this.max_reconnect_attempts||this.reconnect_attempts<this.max_reconnect_attempts?(this.reconnect_attempts++,this.connect()):this.stopAutoReconnect()}}WebSocketClient.status={disconnected:0,connected:1,error:2,connecting:3,string:["Disconnected","Connected","Error","Connecting"]};